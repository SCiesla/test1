from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore
from django_apscheduler.jobstores import DjangoJobStore

jobstores = {
    'default': DjangoJobStore()
}

scheduler = BackgroundScheduler(jobstores=jobstores)
scheduler.start()

# W widoku
def update_schedule(request):
    schedule = request.POST.get('schedule')  # np. "0 */2 * * *"
    
    # Usu≈Ñ stare zadanie
    scheduler.remove_job('my_job_id')
    
    # Dodaj nowe
    scheduler.add_job(
        my_function,
        'cron',
        hour='*/2',
        id='my_job_id',
        replace_existing=True
    )